

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="X1ly?S">
  <meta name="keywords" content="网络安全 渗透测试 web安全">
  
    <meta name="description" content="加密发现开局一个登录框，开逆！  输入任意账号密码登录，抓包，看看载荷  pwd是密码参数，被前端加密了 密码合法性前端校验如果我输入一长串密码，点击登录，发现抓不到登录包，为什么呢？  来看看js怎么写的吧，多半是有前端的密码合法性校验，只有先通过了前端的合法性校验，数据包才能发给服务器，才能被抓到包  好家伙，一眼就找到了，原来是限制了密码的位数6-16位，否则就不发包，over 逆向加密过程">
<meta property="og:type" content="article">
<meta property="og:title" content="JS逆向实战-房天下登录系统">
<meta property="og:url" content="https://x1lys.github.io/2024/08/02/JS%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98-%E6%88%BF%E5%A4%A9%E4%B8%8B%E7%99%BB%E5%BD%95%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="X1ly?S Blog">
<meta property="og:description" content="加密发现开局一个登录框，开逆！  输入任意账号密码登录，抓包，看看载荷  pwd是密码参数，被前端加密了 密码合法性前端校验如果我输入一长串密码，点击登录，发现抓不到登录包，为什么呢？  来看看js怎么写的吧，多半是有前端的密码合法性校验，只有先通过了前端的合法性校验，数据包才能发给服务器，才能被抓到包  好家伙，一眼就找到了，原来是限制了密码的位数6-16位，否则就不发包，over 逆向加密过程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/mZvsUjCEH9d3BDS.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/vfHzq3J1d74rwGt.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/2mQR9C8ndPKXfZb.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/vALZMlenzWF5QNc.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/gPts3IvYrkUToAn.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/uiDbnol97RNdFjK.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/CdLUHA41EmVpQoO.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/FwVyf9t4dDRi6He.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/HTqkpEC7wd2FSz1.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/6wO8sGjT4VD5Yd7.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/okVZldzs8pqTHw6.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/m5sqDZdS7BXVn6A.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/LZE3BGOxwPukYb4.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/Sca4B8o9xEWmHjg.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/rHucXeplf5IGhOV.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/4oczmtOMnariNRD.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/1o4bn7ANaqGY5lU.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/Dli2ckpo9LFtjq3.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/3UsVjW18gXYvmTc.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/yUHlWVpovCgkQOE.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/OrqJRFQxeSnAh23.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/RXUuB2o7FSvflwJ.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/1EwqNxzeiOBnL8h.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/q2JP9FVK5kXeOtD.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/BhFbG8wPjkL6igM.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/GTScJVu8qkQUh9E.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/M8d3ie1t5Fgr6RP.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/R3aJXCYyW7zHNKe.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/6hCNk2xLDjFiqVv.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/s2IAXnOSFypEdYz.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/kb5eHinTKYxL9CG.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/21/dgx3uQIt9mwLanE.png">
<meta property="article:published_time" content="2024-08-02T09:43:40.000Z">
<meta property="article:modified_time" content="2024-10-21T14:18:17.265Z">
<meta property="article:author" content="X1ly?S">
<meta property="article:tag" content="JS逆向">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s2.loli.net/2024/10/21/mZvsUjCEH9d3BDS.png">
  
  
  
  <title>JS逆向实战-房天下登录系统 - X1ly?S Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"x1lys.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="JS逆向实战-房天下登录系统"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-08-02 17:43" pubdate>
          2024年8月2日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.8k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          49 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">JS逆向实战-房天下登录系统</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="加密发现"><a href="#加密发现" class="headerlink" title="加密发现"></a>加密发现</h2><p>开局一个登录框，开逆！</p>
<p><img src="https://s2.loli.net/2024/10/21/mZvsUjCEH9d3BDS.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>输入任意账号密码登录，抓包，看看载荷</p>
<p><img src="https://s2.loli.net/2024/10/21/vfHzq3J1d74rwGt.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>pwd是密码参数，被前端加密了</p>
<h2 id="密码合法性前端校验"><a href="#密码合法性前端校验" class="headerlink" title="密码合法性前端校验"></a>密码合法性前端校验</h2><p>如果我输入一长串密码，点击登录，发现抓不到登录包，为什么呢？</p>
<p><img src="https://s2.loli.net/2024/10/21/2mQR9C8ndPKXfZb.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>来看看js怎么写的吧，多半是有前端的密码合法性校验，只有先通过了前端的合法性校验，数据包才能发给服务器，才能被抓到包</p>
<p><img src="https://s2.loli.net/2024/10/21/vALZMlenzWF5QNc.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>好家伙，一眼就找到了，原来是限制了密码的位数6-16位，否则就不发包，over</p>
<h2 id="逆向加密过程"><a href="#逆向加密过程" class="headerlink" title="逆向加密过程"></a>逆向加密过程</h2><p>ok，进入正题</p>
<p>全局搜索pwd，寻找pwd的加密入口点，我自称加密点</p>
<p><img src="https://s2.loli.net/2024/10/21/gPts3IvYrkUToAn.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>看到了”encrypt”多半就是这里了，点击跟进，为了确定加密点就是这里，可以在这里下个断，再点击登录触发加密流程，看看是否程序会停在这里，调试一下值，看看是否真的是在经过这个点之后，pwd就由明文变为密文了</p>
<p>（由于我登录次数太多，被封了24h，就没办法放调试结果的截图了，但之前我调试成功了）</p>
<p><img src="https://s2.loli.net/2024/10/21/uiDbnol97RNdFjK.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>经测试，这里的确是加密点，分析一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">encryptedString</span>(key_to_encode, that.<span class="hljs-property">password</span>.<span class="hljs-title function_">val</span>())<br></code></pre></td></tr></table></figure>

<p><strong>encryptedString</strong>函数接收<strong>key_to_encode</strong>和**that.password.val()**两个值，后者不用说，就是原始密码，前者是什么呢，找一找</p>
<p>全局搜索<strong>key_to_encod</strong>：</p>
<p><img src="https://s2.loli.net/2024/10/21/CdLUHA41EmVpQoO.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>一眼找到</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> key_to_encode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RSAKeyPair</span>(<span class="hljs-string">&quot;010001&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;978C0A92D2173439707498F0944AA476B1B62595877DD6FA87F6E2AC6DCB3D0BF0B82857439C99B5091192BC134889DFF60C562EC54EFBA4FF2F9D55ADBCCEA4A2FBA80CB398ED501280A007C83AF30C3D1A142D6133C63012B90AB26AC60C898FB66EDC3192C3EC4FF66925A64003B72496099F4F09A9FB72A2CF9E4D770C41&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>但是<strong>key_to_encod</strong>不是一个静态值，也是使用函数计算出的动态值，怎么办呢，不慌，跟进<strong>RSAKeyPair</strong>函数看看</p>
<p><img src="https://s2.loli.net/2024/10/21/FwVyf9t4dDRi6He.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>可以看到这个函数中又进行了一些数据流的传递，难道又要继续跟进内层的函数跟踪数据流吗？其实不用，因为<strong>RSAKeyPair</strong>函数是在<strong>RSA.min.js</strong>文件中定义的，<strong>RSA.min.js</strong>文件不就是<strong>RSA的加密库</strong>吗，现成的，开发图方便直接调用这个加密库，那我也图了个方便，直接调用这个加密库，自写一下入口函数就行了，不用再跟踪数据流的传递了</p>
<p>那么，回到<strong>encryptedString</strong>函数，<strong>现在已知第一个参数就是调用RSA加密库中的函数计算出来的，第二个参数就是原始密码</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">encryptedString</span>(key_to_encode, that.<span class="hljs-property">password</span>.<span class="hljs-title function_">val</span>())<br></code></pre></td></tr></table></figure>

<p>那么不就逆出来了吗，可以再跟进<strong>encryptedString</strong>函数看看，是不是这么一回事</p>
<p><img src="https://s2.loli.net/2024/10/21/HTqkpEC7wd2FSz1.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>果然，<strong>encryptedString</strong>函数也是在RSA加密库里，这下确定了，整个前端加密就是直接套用的<strong>RSA.min.js</strong>加密库，不涉及自写算法或者修改的情况，over</p>
<h2 id="模拟还原加密过程"><a href="#模拟还原加密过程" class="headerlink" title="模拟还原加密过程"></a>模拟还原加密过程</h2><p>看看<strong>RSA.min.js</strong>，也就四百多行</p>
<p><img src="https://s2.loli.net/2024/10/21/6wO8sGjT4VD5Yd7.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>打开鬼鬼调试，直接全选复制过去，加载代码，成功加载，没有bug</p>
<p><img src="https://s2.loli.net/2024/10/21/okVZldzs8pqTHw6.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>现在这个代码段，加密逻辑都有了，还缺点什么呢？</p>
<p>缺少入口函数去调用这些加密逻辑以及缺少key的定义</p>
<p>前把kay的定义复制出来，就是<strong>key_to_encode</strong>这个，前面找到了它单独在html源码中，我们给它拿出来</p>
<p><img src="https://s2.loli.net/2024/10/21/m5sqDZdS7BXVn6A.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> key_to_encode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RSAKeyPair</span>(<span class="hljs-string">&quot;010001&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;978C0A92D2173439707498F0944AA476B1B62595877DD6FA87F6E2AC6DCB3D0BF0B82857439C99B5091192BC134889DFF60C562EC54EFBA4FF2F9D55ADBCCEA4A2FBA80CB398ED501280A007C83AF30C3D1A142D6133C63012B90AB26AC60C898FB66EDC3192C3EC4FF66925A64003B72496099F4F09A9FB72A2CF9E4D770C41&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>给当前代码段加一个入口函数，去调用这些RSA加密库的逻辑，并把<strong>key_to_encode</strong>定义在里面</p>
<p>怎么写呢？直接找前面说过的加密入口点，把这个函数拿出来，不就可以调用整个<strong>RAS.min.js</strong>的逻辑了吗</p>
<p><img src="https://s2.loli.net/2024/10/21/LZE3BGOxwPukYb4.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">encryptedString</span>(key_to_encode, pwd)<br></code></pre></td></tr></table></figure>

<p><strong>注意修改一下第二个参数，改为我们自定义的参数，手动传参原始密码，而不是从that.password.val()接收再取值了</strong></p>
<p>整体的入口函数就是这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"> <br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span> (<span class="hljs-params">pwd</span>)&#123;<br>        <span class="hljs-title function_">setMaxDigits</span>(<span class="hljs-number">129</span>);<br>        <span class="hljs-keyword">var</span> key_to_encode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RSAKeyPair</span>(<span class="hljs-string">&quot;010001&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;978C0A92D2173439707498F0944AA476B1B62595877DD6FA87F6E2AC6DCB3D0BF0B82857439C99B5091192BC134889DFF60C562EC54EFBA4FF2F9D55ADBCCEA4A2FBA80CB398ED501280A007C83AF30C3D1A142D6133C63012B90AB26AC60C898FB66EDC3192C3EC4FF66925A64003B72496099F4F09A9FB72A2CF9E4D770C41&quot;</span>);<br>    <br><span class="hljs-keyword">return</span> <span class="hljs-title function_">encryptedString</span>(key_to_encode, pwd);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在鬼鬼里调试一下看看输出</p>
<p><img src="https://s2.loli.net/2024/10/21/Sca4B8o9xEWmHjg.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><strong>可以看到成功模拟还原出整个加密过程，可以实现正确的加密数据了</strong></p>
<h2 id="写脚本批量加密数据"><a href="#写脚本批量加密数据" class="headerlink" title="写脚本批量加密数据"></a>写脚本批量加密数据</h2><p>直接开始写脚本，批量加密数据</p>
<p>这种直接套用RSA加密库的前端加密情况，该怎么写脚本呢？很简单，直接使用<strong>execjs</strong>库，在py中去调用执行JS代码，那么我们直接把<strong>RSA.min.js</strong>存为一个js文件，再使用py的<strong>execjs</strong>库调用执行，就不用再自己写加密逻辑了，加密逻辑全部由现成的<strong>RSA.min.js</strong>加密库完成，py脚本要做的其实就只是<strong>实现数据的批量输入与输出</strong>。ok不废话了，上脚本</p>
<h3 id="rsa-js"><a href="#rsa-js" class="headerlink" title="rsa.js"></a>rsa.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setMaxDigits</span>(<span class="hljs-params">n</span>) &#123;<br>    maxDigits = n;<br>    <span class="hljs-variable constant_">ZERO_ARRAY</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(maxDigits);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> t = <span class="hljs-number">0</span>; t &lt; <span class="hljs-variable constant_">ZERO_ARRAY</span>.<span class="hljs-property">length</span>; t++)<br>        <span class="hljs-variable constant_">ZERO_ARRAY</span>[t] = <span class="hljs-number">0</span>;<br>    bigZero = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>;<br>    bigOne = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>;<br>    bigOne.<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">BigInt</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">digits</span> = <span class="hljs-keyword">typeof</span> n == <span class="hljs-string">&quot;boolean&quot;</span> &amp;&amp; n == !<span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : <span class="hljs-variable constant_">ZERO_ARRAY</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isNeg</span> = !<span class="hljs-number">1</span><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biFromDecimal</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> u = n.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>) == <span class="hljs-string">&quot;-&quot;</span>, t = u ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>, i, f, r; t &lt; n.<span class="hljs-property">length</span> &amp;&amp; n.<span class="hljs-title function_">charAt</span>(t) == <span class="hljs-string">&quot;0&quot;</span>; )<br>        ++t;<br>    <span class="hljs-keyword">if</span> (t == n.<span class="hljs-property">length</span>)<br>        i = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">for</span> (f = n.<span class="hljs-property">length</span> - t,<br>        r = f % dpl10,<br>        r == <span class="hljs-number">0</span> &amp;&amp; (r = dpl10),<br>        i = <span class="hljs-title function_">biFromNumber</span>(<span class="hljs-title class_">Number</span>(n.<span class="hljs-title function_">substr</span>(t, r))),<br>        t += r; t &lt; n.<span class="hljs-property">length</span>; )<br>            i = <span class="hljs-title function_">biAdd</span>(<span class="hljs-title function_">biMultiply</span>(i, lr10), <span class="hljs-title function_">biFromNumber</span>(<span class="hljs-title class_">Number</span>(n.<span class="hljs-title function_">substr</span>(t, dpl10)))),<br>            t += dpl10;<br>        i.<span class="hljs-property">isNeg</span> = u<br>    &#125;<br>    <span class="hljs-keyword">return</span> i<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biCopy</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>(!<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">return</span> t.<span class="hljs-property">digits</span> = n.<span class="hljs-property">digits</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>),<br>    t.<span class="hljs-property">isNeg</span> = n.<span class="hljs-property">isNeg</span>,<br>    t<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biFromNumber</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>, i;<br>    <span class="hljs-keyword">for</span> (t.<span class="hljs-property">isNeg</span> = n &lt; <span class="hljs-number">0</span>,<br>    n = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(n),<br>    i = <span class="hljs-number">0</span>; n &gt; <span class="hljs-number">0</span>; )<br>        t.<span class="hljs-property">digits</span>[i++] = n &amp; maxDigitVal,<br>        n = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(n / biRadix);<br>    <span class="hljs-keyword">return</span> t<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">reverseStr</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-string">&quot;&quot;</span>, t = n.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; t &gt; -<span class="hljs-number">1</span>; --t)<br>        i += n.<span class="hljs-title function_">charAt</span>(t);<br>    <span class="hljs-keyword">return</span> i<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biToString</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>, i, u;<br>    <span class="hljs-keyword">for</span> (r.<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>] = t,<br>    i = <span class="hljs-title function_">biDivideModulo</span>(n, r),<br>    u = hexatrigesimalToChar[i[<span class="hljs-number">1</span>].<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>]]; <span class="hljs-title function_">biCompare</span>(i[<span class="hljs-number">0</span>], bigZero) == <span class="hljs-number">1</span>; )<br>        i = <span class="hljs-title function_">biDivideModulo</span>(i[<span class="hljs-number">0</span>], r),<br>        digit = i[<span class="hljs-number">1</span>].<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>],<br>        u += hexatrigesimalToChar[i[<span class="hljs-number">1</span>].<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>]];<br>    <span class="hljs-keyword">return</span> (n.<span class="hljs-property">isNeg</span> ? <span class="hljs-string">&quot;-&quot;</span> : <span class="hljs-string">&quot;&quot;</span>) + <span class="hljs-title function_">reverseStr</span>(u)<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biToDecimal</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">var</span> i = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>, t, r;<br>    <span class="hljs-keyword">for</span> (i.<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>] = <span class="hljs-number">10</span>,<br>    t = <span class="hljs-title function_">biDivideModulo</span>(n, i),<br>    r = <span class="hljs-title class_">String</span>(t[<span class="hljs-number">1</span>].<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>]); <span class="hljs-title function_">biCompare</span>(t[<span class="hljs-number">0</span>], bigZero) == <span class="hljs-number">1</span>; )<br>        t = <span class="hljs-title function_">biDivideModulo</span>(t[<span class="hljs-number">0</span>], i),<br>        r += <span class="hljs-title class_">String</span>(t[<span class="hljs-number">1</span>].<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>]);<br>    <span class="hljs-keyword">return</span> (n.<span class="hljs-property">isNeg</span> ? <span class="hljs-string">&quot;-&quot;</span> : <span class="hljs-string">&quot;&quot;</span>) + <span class="hljs-title function_">reverseStr</span>(r)<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">digitToHex</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">var</span> t = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; ++i)<br>        t += hexToChar[n &amp; <span class="hljs-number">15</span>],<br>        n &gt;&gt;&gt;= <span class="hljs-number">4</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">reverseStr</span>(t)<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biToHex</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-string">&quot;&quot;</span>, r = <span class="hljs-title function_">biHighIndex</span>(n), t = <span class="hljs-title function_">biHighIndex</span>(n); t &gt; -<span class="hljs-number">1</span>; --t)<br>        i += <span class="hljs-title function_">digitToHex</span>(n.<span class="hljs-property">digits</span>[t]);<br>    <span class="hljs-keyword">return</span> i<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">charToHex</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">var</span> t = <span class="hljs-number">48</span><br>      , u = t + <span class="hljs-number">9</span><br>      , i = <span class="hljs-number">97</span><br>      , f = i + <span class="hljs-number">25</span><br>      , r = <span class="hljs-number">65</span>;<br>    <span class="hljs-keyword">return</span> n &gt;= t &amp;&amp; n &lt;= u ? n - t : n &gt;= r &amp;&amp; n &lt;= <span class="hljs-number">90</span> ? <span class="hljs-number">10</span> + n - r : n &gt;= i &amp;&amp; n &lt;= f ? <span class="hljs-number">10</span> + n - i : <span class="hljs-number">0</span><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">hexToDigit</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> t = <span class="hljs-number">0</span>, r = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(n.<span class="hljs-property">length</span>, <span class="hljs-number">4</span>), i = <span class="hljs-number">0</span>; i &lt; r; ++i)<br>        t &lt;&lt;= <span class="hljs-number">4</span>,<br>        t |= <span class="hljs-title function_">charToHex</span>(n.<span class="hljs-title function_">charCodeAt</span>(i));<br>    <span class="hljs-keyword">return</span> t<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biFromHex</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>, u = n.<span class="hljs-property">length</span>, t = u, r = <span class="hljs-number">0</span>; t &gt; <span class="hljs-number">0</span>; t -= <span class="hljs-number">4</span>,<br>    ++r)<br>        i.<span class="hljs-property">digits</span>[r] = <span class="hljs-title function_">hexToDigit</span>(n.<span class="hljs-title function_">substr</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(t - <span class="hljs-number">4</span>, <span class="hljs-number">0</span>), <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(t, <span class="hljs-number">4</span>)));<br>    <span class="hljs-keyword">return</span> i<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biFromString</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> f = n.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>) == <span class="hljs-string">&quot;-&quot;</span>, e = f ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>, i = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>, r = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>, u;<br>    <span class="hljs-keyword">for</span> (r.<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>,<br>    u = n.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; u &gt;= e; u--) &#123;<br>        <span class="hljs-keyword">var</span> o = n.<span class="hljs-title function_">charCodeAt</span>(u)<br>          , s = <span class="hljs-title function_">charToHex</span>(o)<br>          , h = <span class="hljs-title function_">biMultiplyDigit</span>(r, s);<br>        i = <span class="hljs-title function_">biAdd</span>(i, h);<br>        r = <span class="hljs-title function_">biMultiplyDigit</span>(r, t)<br>    &#125;<br>    <span class="hljs-keyword">return</span> i.<span class="hljs-property">isNeg</span> = f,<br>    i<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biDump</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">return</span> (n.<span class="hljs-property">isNeg</span> ? <span class="hljs-string">&quot;-&quot;</span> : <span class="hljs-string">&quot;&quot;</span>) + n.<span class="hljs-property">digits</span>.<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot; &quot;</span>)<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biAdd</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> r, u, f, i;<br>    <span class="hljs-keyword">if</span> (n.<span class="hljs-property">isNeg</span> != t.<span class="hljs-property">isNeg</span>)<br>        t.<span class="hljs-property">isNeg</span> = !t.<span class="hljs-property">isNeg</span>,<br>        r = <span class="hljs-title function_">biSubtract</span>(n, t),<br>        t.<span class="hljs-property">isNeg</span> = !t.<span class="hljs-property">isNeg</span>;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">for</span> (r = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>,<br>        u = <span class="hljs-number">0</span>,<br>        i = <span class="hljs-number">0</span>; i &lt; n.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span>; ++i)<br>            f = n.<span class="hljs-property">digits</span>[i] + t.<span class="hljs-property">digits</span>[i] + u,<br>            r.<span class="hljs-property">digits</span>[i] = f % biRadix,<br>            u = <span class="hljs-title class_">Number</span>(f &gt;= biRadix);<br>        r.<span class="hljs-property">isNeg</span> = n.<span class="hljs-property">isNeg</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> r<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biSubtract</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> r, f, u, i;<br>    <span class="hljs-keyword">if</span> (n.<span class="hljs-property">isNeg</span> != t.<span class="hljs-property">isNeg</span>)<br>        t.<span class="hljs-property">isNeg</span> = !t.<span class="hljs-property">isNeg</span>,<br>        r = <span class="hljs-title function_">biAdd</span>(n, t),<br>        t.<span class="hljs-property">isNeg</span> = !t.<span class="hljs-property">isNeg</span>;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">for</span> (r = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>,<br>        u = <span class="hljs-number">0</span>,<br>        i = <span class="hljs-number">0</span>; i &lt; n.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span>; ++i)<br>            f = n.<span class="hljs-property">digits</span>[i] - t.<span class="hljs-property">digits</span>[i] + u,<br>            r.<span class="hljs-property">digits</span>[i] = f % biRadix,<br>            r.<span class="hljs-property">digits</span>[i] &lt; <span class="hljs-number">0</span> &amp;&amp; (r.<span class="hljs-property">digits</span>[i] += biRadix),<br>            u = <span class="hljs-number">0</span> - <span class="hljs-title class_">Number</span>(f &lt; <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (u == -<span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">for</span> (u = <span class="hljs-number">0</span>,<br>            i = <span class="hljs-number">0</span>; i &lt; n.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span>; ++i)<br>                f = <span class="hljs-number">0</span> - r.<span class="hljs-property">digits</span>[i] + u,<br>                r.<span class="hljs-property">digits</span>[i] = f % biRadix,<br>                r.<span class="hljs-property">digits</span>[i] &lt; <span class="hljs-number">0</span> &amp;&amp; (r.<span class="hljs-property">digits</span>[i] += biRadix),<br>                u = <span class="hljs-number">0</span> - <span class="hljs-title class_">Number</span>(f &lt; <span class="hljs-number">0</span>);<br>            r.<span class="hljs-property">isNeg</span> = !n.<span class="hljs-property">isNeg</span><br>        &#125; <span class="hljs-keyword">else</span><br>            r.<span class="hljs-property">isNeg</span> = n.<span class="hljs-property">isNeg</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> r<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biHighIndex</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> t = n.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; t &gt; <span class="hljs-number">0</span> &amp;&amp; n.<span class="hljs-property">digits</span>[t] == <span class="hljs-number">0</span>; )<br>        --t;<br>    <span class="hljs-keyword">return</span> t<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biNumBits</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-title function_">biHighIndex</span>(n), r = n.<span class="hljs-property">digits</span>[i], u = (i + <span class="hljs-number">1</span>) * bitsPerDigit, t = u; t &gt; u - bitsPerDigit; --t) &#123;<br>        <span class="hljs-keyword">if</span> ((r &amp; <span class="hljs-number">32768</span>) != <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">break</span>;<br>        r &lt;&lt;= <span class="hljs-number">1</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> t<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biMultiply</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>, u, o = <span class="hljs-title function_">biHighIndex</span>(n), s = <span class="hljs-title function_">biHighIndex</span>(t), e, f, r = <span class="hljs-number">0</span>; r &lt;= s; ++r) &#123;<br>        <span class="hljs-keyword">for</span> (u = <span class="hljs-number">0</span>,<br>        f = r,<br>        j = <span class="hljs-number">0</span>; j &lt;= o; ++j,<br>        ++f)<br>            e = i.<span class="hljs-property">digits</span>[f] + n.<span class="hljs-property">digits</span>[j] * t.<span class="hljs-property">digits</span>[r] + u,<br>            i.<span class="hljs-property">digits</span>[f] = e &amp; maxDigitVal,<br>            u = e &gt;&gt;&gt; biRadixBits;<br>        i.<span class="hljs-property">digits</span>[r + o + <span class="hljs-number">1</span>] = u<br>    &#125;<br>    <span class="hljs-keyword">return</span> i.<span class="hljs-property">isNeg</span> = n.<span class="hljs-property">isNeg</span> != t.<span class="hljs-property">isNeg</span>,<br>    i<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biMultiplyDigit</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> u, r, f, i;<br>    <span class="hljs-keyword">for</span> (result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>,<br>    u = <span class="hljs-title function_">biHighIndex</span>(n),<br>    r = <span class="hljs-number">0</span>,<br>    i = <span class="hljs-number">0</span>; i &lt;= u; ++i)<br>        f = result.<span class="hljs-property">digits</span>[i] + n.<span class="hljs-property">digits</span>[i] * t + r,<br>        result.<span class="hljs-property">digits</span>[i] = f &amp; maxDigitVal,<br>        r = f &gt;&gt;&gt; biRadixBits;<br>    <span class="hljs-keyword">return</span> result.<span class="hljs-property">digits</span>[<span class="hljs-number">1</span> + u] = r,<br>    result<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">arrayCopy</span>(<span class="hljs-params">n, t, i, r, u</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> o = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(t + u, n.<span class="hljs-property">length</span>), f = t, e = r; f &lt; o; ++f,<br>    ++e)<br>        i[e] = n[f]<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biShiftLeft</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> e = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(t / bitsPerDigit), i = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>, u, o, r, f;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-title function_">arrayCopy</span>(n.<span class="hljs-property">digits</span>, <span class="hljs-number">0</span>, i.<span class="hljs-property">digits</span>, e, i.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> - e),<br>    u = t % bitsPerDigit,<br>    o = bitsPerDigit - u,<br>    r = i.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>,<br>    f = r - <span class="hljs-number">1</span>; r &gt; <span class="hljs-number">0</span>; --r,<br>    --f)<br>        i.<span class="hljs-property">digits</span>[r] = i.<span class="hljs-property">digits</span>[r] &lt;&lt; u &amp; maxDigitVal | (i.<span class="hljs-property">digits</span>[f] &amp; highBitMasks[u]) &gt;&gt;&gt; o;<br>    <span class="hljs-keyword">return</span> i.<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>] = i.<span class="hljs-property">digits</span>[r] &lt;&lt; u &amp; maxDigitVal,<br>    i.<span class="hljs-property">isNeg</span> = n.<span class="hljs-property">isNeg</span>,<br>    i<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biShiftRight</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> e = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(t / bitsPerDigit), i = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>, u, o, r, f;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-title function_">arrayCopy</span>(n.<span class="hljs-property">digits</span>, e, i.<span class="hljs-property">digits</span>, <span class="hljs-number">0</span>, n.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> - e),<br>    u = t % bitsPerDigit,<br>    o = bitsPerDigit - u,<br>    r = <span class="hljs-number">0</span>,<br>    f = r + <span class="hljs-number">1</span>; r &lt; i.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; ++r,<br>    ++f)<br>        i.<span class="hljs-property">digits</span>[r] = i.<span class="hljs-property">digits</span>[r] &gt;&gt;&gt; u | (i.<span class="hljs-property">digits</span>[f] &amp; lowBitMasks[u]) &lt;&lt; o;<br>    <span class="hljs-keyword">return</span> i.<span class="hljs-property">digits</span>[i.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] &gt;&gt;&gt;= u,<br>    i.<span class="hljs-property">isNeg</span> = n.<span class="hljs-property">isNeg</span>,<br>    i<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biMultiplyByRadixPower</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> i = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">arrayCopy</span>(n.<span class="hljs-property">digits</span>, <span class="hljs-number">0</span>, i.<span class="hljs-property">digits</span>, t, i.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> - t),<br>    i<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biDivideByRadixPower</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> i = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">arrayCopy</span>(n.<span class="hljs-property">digits</span>, t, i.<span class="hljs-property">digits</span>, <span class="hljs-number">0</span>, i.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> - t),<br>    i<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biModuloByRadixPower</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> i = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">arrayCopy</span>(n.<span class="hljs-property">digits</span>, <span class="hljs-number">0</span>, i.<span class="hljs-property">digits</span>, <span class="hljs-number">0</span>, t),<br>    i<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biCompare</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">if</span> (n.<span class="hljs-property">isNeg</span> != t.<span class="hljs-property">isNeg</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> - <span class="hljs-number">2</span> * <span class="hljs-title class_">Number</span>(n.<span class="hljs-property">isNeg</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = n.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; --i)<br>        <span class="hljs-keyword">if</span> (n.<span class="hljs-property">digits</span>[i] != t.<span class="hljs-property">digits</span>[i])<br>            <span class="hljs-keyword">return</span> n.<span class="hljs-property">isNeg</span> ? <span class="hljs-number">1</span> - <span class="hljs-number">2</span> * <span class="hljs-title class_">Number</span>(n.<span class="hljs-property">digits</span>[i] &gt; t.<span class="hljs-property">digits</span>[i]) : <span class="hljs-number">1</span> - <span class="hljs-number">2</span> * <span class="hljs-title class_">Number</span>(n.<span class="hljs-property">digits</span>[i] &lt; t.<span class="hljs-property">digits</span>[i]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biDivideModulo</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> a = <span class="hljs-title function_">biNumBits</span>(n), s = <span class="hljs-title function_">biNumBits</span>(t), v = t.<span class="hljs-property">isNeg</span>, r, i, u, e, h, o, f, y, p;<br>    <span class="hljs-keyword">if</span> (a &lt; s)<br>        <span class="hljs-keyword">return</span> n.<span class="hljs-property">isNeg</span> ? (r = <span class="hljs-title function_">biCopy</span>(bigOne),<br>        r.<span class="hljs-property">isNeg</span> = !t.<span class="hljs-property">isNeg</span>,<br>        n.<span class="hljs-property">isNeg</span> = !<span class="hljs-number">1</span>,<br>        t.<span class="hljs-property">isNeg</span> = !<span class="hljs-number">1</span>,<br>        i = <span class="hljs-title function_">biSubtract</span>(t, n),<br>        n.<span class="hljs-property">isNeg</span> = !<span class="hljs-number">0</span>,<br>        t.<span class="hljs-property">isNeg</span> = v) : (r = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>,<br>        i = <span class="hljs-title function_">biCopy</span>(n)),<br>        [r, i];<br>    <span class="hljs-keyword">for</span> (r = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>,<br>    i = n,<br>    u = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(s / bitsPerDigit) - <span class="hljs-number">1</span>,<br>    e = <span class="hljs-number">0</span>; t.<span class="hljs-property">digits</span>[u] &lt; biHalfRadix; )<br>        t = <span class="hljs-title function_">biShiftLeft</span>(t, <span class="hljs-number">1</span>),<br>        ++e,<br>        ++s,<br>        u = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(s / bitsPerDigit) - <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-title function_">biShiftLeft</span>(i, e),<br>    a += e,<br>    h = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(a / bitsPerDigit) - <span class="hljs-number">1</span>,<br>    o = <span class="hljs-title function_">biMultiplyByRadixPower</span>(t, h - u); <span class="hljs-title function_">biCompare</span>(i, o) != -<span class="hljs-number">1</span>; )<br>        ++r.<span class="hljs-property">digits</span>[h - u],<br>        i = <span class="hljs-title function_">biSubtract</span>(i, o);<br>    <span class="hljs-keyword">for</span> (f = h; f &gt; u; --f) &#123;<br>        <span class="hljs-keyword">var</span> c = f &gt;= i.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> ? <span class="hljs-number">0</span> : i.<span class="hljs-property">digits</span>[f]<br>          , w = f - <span class="hljs-number">1</span> &gt;= i.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> ? <span class="hljs-number">0</span> : i.<span class="hljs-property">digits</span>[f - <span class="hljs-number">1</span>]<br>          , b = f - <span class="hljs-number">2</span> &gt;= i.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> ? <span class="hljs-number">0</span> : i.<span class="hljs-property">digits</span>[f - <span class="hljs-number">2</span>]<br>          , l = u &gt;= t.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> ? <span class="hljs-number">0</span> : t.<span class="hljs-property">digits</span>[u]<br>          , k = u - <span class="hljs-number">1</span> &gt;= t.<span class="hljs-property">digits</span>.<span class="hljs-property">length</span> ? <span class="hljs-number">0</span> : t.<span class="hljs-property">digits</span>[u - <span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">for</span> (r.<span class="hljs-property">digits</span>[f - u - <span class="hljs-number">1</span>] = c == l ? maxDigitVal : <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((c * biRadix + w) / l),<br>        y = r.<span class="hljs-property">digits</span>[f - u - <span class="hljs-number">1</span>] * (l * biRadix + k),<br>        p = c * biRadixSquared + (w * biRadix + b); y &gt; p; )<br>            --r.<span class="hljs-property">digits</span>[f - u - <span class="hljs-number">1</span>],<br>            y = r.<span class="hljs-property">digits</span>[f - u - <span class="hljs-number">1</span>] * (l * biRadix | k),<br>            p = c * biRadix * biRadix + (w * biRadix + b);<br>        o = <span class="hljs-title function_">biMultiplyByRadixPower</span>(t, f - u - <span class="hljs-number">1</span>);<br>        i = <span class="hljs-title function_">biSubtract</span>(i, <span class="hljs-title function_">biMultiplyDigit</span>(o, r.<span class="hljs-property">digits</span>[f - u - <span class="hljs-number">1</span>]));<br>        i.<span class="hljs-property">isNeg</span> &amp;&amp; (i = <span class="hljs-title function_">biAdd</span>(i, o),<br>        --r.<span class="hljs-property">digits</span>[f - u - <span class="hljs-number">1</span>])<br>    &#125;<br>    <span class="hljs-keyword">return</span> i = <span class="hljs-title function_">biShiftRight</span>(i, e),<br>    r.<span class="hljs-property">isNeg</span> = n.<span class="hljs-property">isNeg</span> != v,<br>    n.<span class="hljs-property">isNeg</span> &amp;&amp; (r = v ? <span class="hljs-title function_">biAdd</span>(r, bigOne) : <span class="hljs-title function_">biSubtract</span>(r, bigOne),<br>    t = <span class="hljs-title function_">biShiftRight</span>(t, e),<br>    i = <span class="hljs-title function_">biSubtract</span>(t, i)),<br>    i.<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>] == <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-title function_">biHighIndex</span>(i) == <span class="hljs-number">0</span> &amp;&amp; (i.<span class="hljs-property">isNeg</span> = !<span class="hljs-number">1</span>),<br>    [r, i]<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biDivide</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">biDivideModulo</span>(n, t)[<span class="hljs-number">0</span>]<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biModulo</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">biDivideModulo</span>(n, t)[<span class="hljs-number">1</span>]<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biMultiplyMod</span>(<span class="hljs-params">n, t, i</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">biModulo</span>(<span class="hljs-title function_">biMultiply</span>(n, t), i)<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biPow</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> r = bigOne, i = n; ; ) &#123;<br>        <span class="hljs-keyword">if</span> ((t &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> &amp;&amp; (r = <span class="hljs-title function_">biMultiply</span>(r, i)),<br>        t &gt;&gt;= <span class="hljs-number">1</span>,<br>        t == <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">break</span>;<br>        i = <span class="hljs-title function_">biMultiply</span>(i, i)<br>    &#125;<br>    <span class="hljs-keyword">return</span> r<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">biPowMod</span>(<span class="hljs-params">n, t, i</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> f = bigOne, u = n, r = t; ; ) &#123;<br>        <span class="hljs-keyword">if</span> ((r.<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> &amp;&amp; (f = <span class="hljs-title function_">biMultiplyMod</span>(f, u, i)),<br>        r = <span class="hljs-title function_">biShiftRight</span>(r, <span class="hljs-number">1</span>),<br>        r.<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>] == <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-title function_">biHighIndex</span>(r) == <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">break</span>;<br>        u = <span class="hljs-title function_">biMultiplyMod</span>(u, u, i)<br>    &#125;<br>    <span class="hljs-keyword">return</span> f<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">BarrettMu</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">modulus</span> = <span class="hljs-title function_">biCopy</span>(n);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">k</span> = <span class="hljs-title function_">biHighIndex</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modulus</span>) + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>;<br>    t.<span class="hljs-property">digits</span>[<span class="hljs-number">2</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">k</span>] = <span class="hljs-number">1</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mu</span> = <span class="hljs-title function_">biDivide</span>(t, <span class="hljs-variable language_">this</span>.<span class="hljs-property">modulus</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bkplus1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bkplus1</span>.<span class="hljs-property">digits</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">k</span> + <span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">modulo</span> = <span class="hljs-title class_">BarrettMu</span>_modulo;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">multiplyMod</span> = <span class="hljs-title class_">BarrettMu</span>_multiplyMod;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">powMod</span> = <span class="hljs-title class_">BarrettMu</span>_powMod<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">BarrettMu_modulo</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">var</span> r = <span class="hljs-title function_">biDivideByRadixPower</span>(n, <span class="hljs-variable language_">this</span>.<span class="hljs-property">k</span> - <span class="hljs-number">1</span>), u = <span class="hljs-title function_">biMultiply</span>(r, <span class="hljs-variable language_">this</span>.<span class="hljs-property">mu</span>), f = <span class="hljs-title function_">biDivideByRadixPower</span>(u, <span class="hljs-variable language_">this</span>.<span class="hljs-property">k</span> + <span class="hljs-number">1</span>), e = <span class="hljs-title function_">biModuloByRadixPower</span>(n, <span class="hljs-variable language_">this</span>.<span class="hljs-property">k</span> + <span class="hljs-number">1</span>), o = <span class="hljs-title function_">biMultiply</span>(f, <span class="hljs-variable language_">this</span>.<span class="hljs-property">modulus</span>), s = <span class="hljs-title function_">biModuloByRadixPower</span>(o, <span class="hljs-variable language_">this</span>.<span class="hljs-property">k</span> + <span class="hljs-number">1</span>), t = <span class="hljs-title function_">biSubtract</span>(e, s), i;<br>    <span class="hljs-keyword">for</span> (t.<span class="hljs-property">isNeg</span> &amp;&amp; (t = <span class="hljs-title function_">biAdd</span>(t, <span class="hljs-variable language_">this</span>.<span class="hljs-property">bkplus1</span>)),<br>    i = <span class="hljs-title function_">biCompare</span>(t, <span class="hljs-variable language_">this</span>.<span class="hljs-property">modulus</span>) &gt;= <span class="hljs-number">0</span>; i; )<br>        t = <span class="hljs-title function_">biSubtract</span>(t, <span class="hljs-variable language_">this</span>.<span class="hljs-property">modulus</span>),<br>        i = <span class="hljs-title function_">biCompare</span>(t, <span class="hljs-variable language_">this</span>.<span class="hljs-property">modulus</span>) &gt;= <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> t<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">BarrettMu_multiplyMod</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> i = <span class="hljs-title function_">biMultiply</span>(n, t);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">modulo</span>(i)<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">BarrettMu_powMod</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> u = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>, r, i;<br>    <span class="hljs-keyword">for</span> (u.<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>,<br>    r = n,<br>    i = t; ; ) &#123;<br>        <span class="hljs-keyword">if</span> ((i.<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> &amp;&amp; (u = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">multiplyMod</span>(u, r)),<br>        i = <span class="hljs-title function_">biShiftRight</span>(i, <span class="hljs-number">1</span>),<br>        i.<span class="hljs-property">digits</span>[<span class="hljs-number">0</span>] == <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-title function_">biHighIndex</span>(i) == <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">break</span>;<br>        r = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">multiplyMod</span>(r, r)<br>    &#125;<br>    <span class="hljs-keyword">return</span> u<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">RSAKeyPair</span>(<span class="hljs-params">n, t, i</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">e</span> = <span class="hljs-title function_">biFromHex</span>(n);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">d</span> = <span class="hljs-title function_">biFromHex</span>(t);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">m</span> = <span class="hljs-title function_">biFromHex</span>(i);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">digitSize</span> = <span class="hljs-number">2</span> * <span class="hljs-title function_">biHighIndex</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">m</span>) + <span class="hljs-number">2</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chunkSize</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">digitSize</span> - <span class="hljs-number">11</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">radix</span> = <span class="hljs-number">16</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">barrett</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BarrettMu</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">m</span>)<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">twoDigit</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">return</span> (n &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">&quot;0&quot;</span> : <span class="hljs-string">&quot;&quot;</span>) + <span class="hljs-title class_">String</span>(n)<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">encryptedString</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">var</span> e, o, s, h, c, i, f, u, v, l, y;<br>    <span class="hljs-keyword">if</span> (n.<span class="hljs-property">chunkSize</span> &gt; n.<span class="hljs-property">digitSize</span> - <span class="hljs-number">11</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Error&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = [], p = t.<span class="hljs-property">length</span>, r = <span class="hljs-number">0</span>; r &lt; p; )<br>        a[r] = t.<span class="hljs-title function_">charCodeAt</span>(r),<br>        r++;<br>    <span class="hljs-keyword">for</span> (e = a.<span class="hljs-property">length</span>,<br>    o = <span class="hljs-string">&quot;&quot;</span>,<br>    r = <span class="hljs-number">0</span>; r &lt; e; r += n.<span class="hljs-property">chunkSize</span>) &#123;<br>        <span class="hljs-keyword">for</span> (c = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInt</span>,<br>        s = <span class="hljs-number">0</span>,<br>        f = r + n.<span class="hljs-property">chunkSize</span> &gt; e ? e % n.<span class="hljs-property">chunkSize</span> : n.<span class="hljs-property">chunkSize</span>,<br>        u = [],<br>        i = <span class="hljs-number">0</span>; i &lt; f; i++)<br>            u[i] = a[r + f - <span class="hljs-number">1</span> - i];<br>        <span class="hljs-keyword">for</span> (u[f] = <span class="hljs-number">0</span>,<br>        v = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">8</span>, n.<span class="hljs-property">digitSize</span> - <span class="hljs-number">3</span> - f),<br>        i = <span class="hljs-number">0</span>; i &lt; v; i++)<br>            u[f + <span class="hljs-number">1</span> + i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">254</span>) + <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">for</span> (u[n.<span class="hljs-property">digitSize</span> - <span class="hljs-number">2</span>] = <span class="hljs-number">2</span>,<br>        u[n.<span class="hljs-property">digitSize</span> - <span class="hljs-number">1</span>] = <span class="hljs-number">0</span>,<br>        h = <span class="hljs-number">0</span>; h &lt; n.<span class="hljs-property">digitSize</span>; ++s)<br>            c.<span class="hljs-property">digits</span>[s] = u[h++],<br>            c.<span class="hljs-property">digits</span>[s] += u[h++] &lt;&lt; <span class="hljs-number">8</span>;<br>        l = n.<span class="hljs-property">barrett</span>.<span class="hljs-title function_">powMod</span>(c, n.<span class="hljs-property">e</span>);<br>        y = n.<span class="hljs-property">radix</span> == <span class="hljs-number">16</span> ? <span class="hljs-title function_">biToHex</span>(l) : <span class="hljs-title function_">biToString</span>(l, n.<span class="hljs-property">radix</span>);<br>        o += y + <span class="hljs-string">&quot; &quot;</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> o.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, o.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>)<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">decryptedString</span>(<span class="hljs-params">n, t</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> e = t.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot; &quot;</span>), i = <span class="hljs-string">&quot;&quot;</span>, r, u, o, f = <span class="hljs-number">0</span>; f &lt; e.<span class="hljs-property">length</span>; ++f)<br>        <span class="hljs-keyword">for</span> (o = n.<span class="hljs-property">radix</span> == <span class="hljs-number">16</span> ? <span class="hljs-title function_">biFromHex</span>(e[f]) : <span class="hljs-title function_">biFromString</span>(e[f], n.<span class="hljs-property">radix</span>),<br>        u = n.<span class="hljs-property">barrett</span>.<span class="hljs-title function_">powMod</span>(o, n.<span class="hljs-property">d</span>),<br>        r = <span class="hljs-number">0</span>; r &lt;= <span class="hljs-title function_">biHighIndex</span>(u); ++r)<br>            i += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(u.<span class="hljs-property">digits</span>[r] &amp; <span class="hljs-number">255</span>, u.<span class="hljs-property">digits</span>[r] &gt;&gt; <span class="hljs-number">8</span>);<br>    <span class="hljs-keyword">return</span> i.<span class="hljs-title function_">charCodeAt</span>(i.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> &amp;&amp; (i = i.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, i.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>)),<br>    i<br>&#125;<br><span class="hljs-keyword">var</span> biRadixBase = <span class="hljs-number">2</span>, biRadixBits = <span class="hljs-number">16</span>, bitsPerDigit = biRadixBits, biRadix = <span class="hljs-number">65536</span>, biHalfRadix = biRadix &gt;&gt;&gt; <span class="hljs-number">1</span>, biRadixSquared = biRadix * biRadix, maxDigitVal = biRadix - <span class="hljs-number">1</span>, maxInteger = <span class="hljs-number">9999999999999998</span>, maxDigits, <span class="hljs-variable constant_">ZERO_ARRAY</span>, bigZero, bigOne, dpl10, lr10, hexatrigesimalToChar, hexToChar, highBitMasks, lowBitMasks;<br><span class="hljs-title function_">setMaxDigits</span>(<span class="hljs-number">20</span>);<br>dpl10 = <span class="hljs-number">15</span>;<br>lr10 = <span class="hljs-title function_">biFromNumber</span>(<span class="hljs-number">1e15</span>);<br>hexatrigesimalToChar = [<span class="hljs-string">&quot;0&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-string">&quot;6&quot;</span>, <span class="hljs-string">&quot;7&quot;</span>, <span class="hljs-string">&quot;8&quot;</span>, <span class="hljs-string">&quot;9&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;d&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-string">&quot;f&quot;</span>, <span class="hljs-string">&quot;g&quot;</span>, <span class="hljs-string">&quot;h&quot;</span>, <span class="hljs-string">&quot;i&quot;</span>, <span class="hljs-string">&quot;j&quot;</span>, <span class="hljs-string">&quot;k&quot;</span>, <span class="hljs-string">&quot;l&quot;</span>, <span class="hljs-string">&quot;m&quot;</span>, <span class="hljs-string">&quot;n&quot;</span>, <span class="hljs-string">&quot;o&quot;</span>, <span class="hljs-string">&quot;p&quot;</span>, <span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-string">&quot;s&quot;</span>, <span class="hljs-string">&quot;t&quot;</span>, <span class="hljs-string">&quot;u&quot;</span>, <span class="hljs-string">&quot;v&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, <span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-string">&quot;z&quot;</span>];<br>hexToChar = [<span class="hljs-string">&quot;0&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-string">&quot;6&quot;</span>, <span class="hljs-string">&quot;7&quot;</span>, <span class="hljs-string">&quot;8&quot;</span>, <span class="hljs-string">&quot;9&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;d&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-string">&quot;f&quot;</span>];<br>highBitMasks = [<span class="hljs-number">0</span>, <span class="hljs-number">32768</span>, <span class="hljs-number">49152</span>, <span class="hljs-number">57344</span>, <span class="hljs-number">61440</span>, <span class="hljs-number">63488</span>, <span class="hljs-number">64512</span>, <span class="hljs-number">65024</span>, <span class="hljs-number">65280</span>, <span class="hljs-number">65408</span>, <span class="hljs-number">65472</span>, <span class="hljs-number">65504</span>, <span class="hljs-number">65520</span>, <span class="hljs-number">65528</span>, <span class="hljs-number">65532</span>, <span class="hljs-number">65534</span>, <span class="hljs-number">65535</span>];<br>lowBitMasks = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">15</span>, <span class="hljs-number">31</span>, <span class="hljs-number">63</span>, <span class="hljs-number">127</span>, <span class="hljs-number">255</span>, <span class="hljs-number">511</span>, <span class="hljs-number">1023</span>, <span class="hljs-number">2047</span>, <span class="hljs-number">4095</span>, <span class="hljs-number">8191</span>, <span class="hljs-number">16383</span>, <span class="hljs-number">32767</span>, <span class="hljs-number">65535</span>];<br><span class="hljs-title function_">setMaxDigits</span>(<span class="hljs-number">129</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span> (<span class="hljs-params">pwd</span>)&#123;<br>        <span class="hljs-title function_">setMaxDigits</span>(<span class="hljs-number">129</span>);<br>        <span class="hljs-keyword">var</span> key_to_encode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RSAKeyPair</span>(<span class="hljs-string">&quot;010001&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;978C0A92D2173439707498F0944AA476B1B62595877DD6FA87F6E2AC6DCB3D0BF0B82857439C99B5091192BC134889DFF60C562EC54EFBA4FF2F9D55ADBCCEA4A2FBA80CB398ED501280A007C83AF30C3D1A142D6133C63012B90AB26AC60C898FB66EDC3192C3EC4FF66925A64003B72496099F4F09A9FB72A2CF9E4D770C41&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-title function_">encryptedString</span>(key_to_encode, pwd);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="encrypt-py"><a href="#encrypt-py" class="headerlink" title="encrypt.py"></a>encrypt.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> execjs<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-comment"># 加载并编译 JavaScript 代码</span><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;rsa.js&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> js:<br>        js_code = js.read()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;成功加载 JavaScript 代码。&quot;</span>)<br>        encrypt = execjs.<span class="hljs-built_in">compile</span>(js_code)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;成功编译 JavaScript 代码。&quot;</span>)<br><span class="hljs-keyword">except</span> FileNotFoundError:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;错误：未找到 &#x27;rsa.js&#x27; 文件。&quot;</span>)<br>    exit(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;加载或编译 JavaScript 代码时出错：<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>    exit(<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># 加密函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt_data</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;正在加密数据：<span class="hljs-subst">&#123;data[:<span class="hljs-number">30</span>]&#125;</span>...&quot;</span>)  <span class="hljs-comment"># 打印数据的前30个字符以避免泄露</span><br>        encrypted = encrypt.call(<span class="hljs-string">&#x27;main&#x27;</span>, data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;数据加密成功。&quot;</span>)<br>        <span class="hljs-keyword">return</span> encrypted<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;加密数据时出错：<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        exit(<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># 读取 data.txt 中的数据</span><br>input_file = <span class="hljs-string">&#x27;data.txt&#x27;</span><br>output_file = <span class="hljs-string">&#x27;encrypted_data.txt&#x27;</span><br><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_file, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        data = f.read().strip()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;从 <span class="hljs-subst">&#123;input_file&#125;</span> 读取的数据：<span class="hljs-subst">&#123;data[:<span class="hljs-number">30</span>]&#125;</span>...&quot;</span>)  <span class="hljs-comment"># 打印数据的前30个字符</span><br><span class="hljs-keyword">except</span> FileNotFoundError:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误：未找到 &#x27;<span class="hljs-subst">&#123;input_file&#125;</span>&#x27; 文件。&quot;</span>)<br>    exit(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;读取文件 <span class="hljs-subst">&#123;input_file&#125;</span> 时出错：<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>    exit(<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># 执行加密</span><br><span class="hljs-keyword">try</span>:<br>    encrypted_data = encrypt_data(data)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;加密过程中出错：<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>    exit(<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># 将加密结果写入新文件</span><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(encrypted_data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;加密数据已写入 <span class="hljs-subst">&#123;output_file&#125;</span>。&quot;</span>)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;写入文件 <span class="hljs-subst">&#123;output_file&#125;</span> 时出错：<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>    exit(<span class="hljs-number">1</span>)<br><br></code></pre></td></tr></table></figure>

<h3 id="执行截图"><a href="#执行截图" class="headerlink" title="执行截图"></a>执行截图</h3><p><img src="https://s2.loli.net/2024/10/21/rHucXeplf5IGhOV.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><img src="https://s2.loli.net/2024/10/21/4oczmtOMnariNRD.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><img src="https://s2.loli.net/2024/10/21/1o4bn7ANaqGY5lU.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><strong>下面讲讲遇到的几个坑，我也是初学者，相信第一次接触这个的师傅也都遇到过吧……</strong></p>
<h3 id="坑点一-库的安装"><a href="#坑点一-库的安装" class="headerlink" title="坑点一:库的安装"></a>坑点一:库的安装</h3><p>由于py脚本执行需要<strong>execjs</strong>库，一般都是 **pip install  execjs **安装，网上的部分文章也是这样的命令</p>
<p><img src="https://s2.loli.net/2024/10/21/Dli2ckpo9LFtjq3.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>但实际情况无法使用这条命令安装成功，会报错</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">(py39) C:\Users\xxxxx\xxxxx&gt;pip install execjs<br>Looking in indexes: http://mirrors.aliyun.com/pypi/simple/<br>ERROR: Could not find a version that satisfies the requirement execjs (from versions: none)<br>ERROR: No matching distribution found for execjs<br><br>(py39) C:\Users\xxxxx\xxxxx&gt;<br></code></pre></td></tr></table></figure>

<p><strong>execjs 库</strong>在你使用的 PyPI 镜像源中不可用</p>
<p>使用这个命令，成功安装上了 <strong>pip install PyExecJS</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">pip install PyExecJS<br></code></pre></td></tr></table></figure>

<h3 id="坑点二-位数限制未配置导致程序卡死"><a href="#坑点二-位数限制未配置导致程序卡死" class="headerlink" title="坑点二:位数限制未配置导致程序卡死"></a>坑点二:位数限制未配置导致程序卡死</h3><p><strong>第一写的脚本，一切正常，但是就是运行到加密数据时，程序卡死了，一直卡在加密数据的地方，无法执行完成和退出</strong></p>
<p>强制退出程序的话是这样：</p>
<p><img src="https://s2.loli.net/2024/10/21/3UsVjW18gXYvmTc.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>于是我就逐一排查问题：</p>
<p>py的语法是否正确</p>
<p>py的传参是否正确</p>
<p>js的语法是否正确</p>
<p>js的传参是否正确</p>
<p>execjs库是否兼容</p>
<p>其他环境是否正常</p>
<p>js本地再次调试运行（之所以放在最后排查，是因为之前本地所以鬼鬼调试运行过，成功了的）</p>
<p>结果就是在最后一步排查，找到了问题所在：</p>
<p>原来是我的main入口函数中，缺少了一个位数限制配置的代码</p>
<p><strong>再次回到网站HTML源码看看细节：</strong></p>
<p><img src="https://s2.loli.net/2024/10/21/yUHlWVpovCgkQOE.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>就是这个：    <strong>setMaxDigits(129);</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span> (<span class="hljs-params">pwd</span>)&#123;<br>        <span class="hljs-title function_">setMaxDigits</span>(<span class="hljs-number">129</span>);<br>        <span class="hljs-keyword">var</span> key_to_encode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RSAKeyPair</span>(<span class="hljs-string">&quot;010001&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;978C0A92D2173439707498F0944AA476B1B62595877DD6FA87F6E2AC6DCB3D0BF0B82857439C99B5091192BC134889DFF60C562EC54EFBA4FF2F9D55ADBCCEA4A2FBA80CB398ED501280A007C83AF30C3D1A142D6133C63012B90AB26AC60C898FB66EDC3192C3EC4FF66925A64003B72496099F4F09A9FB72A2CF9E4D770C41&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-title function_">encryptedString</span>(key_to_encode, pwd);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在第一次的脚本中，我没有加这一行，因为之前我觉得这个应该没必要吧，就糊弄过去了没有管它，<strong>而且之前模拟还原加密过程时使用鬼鬼调试，没有加这一行代码，也没有出现问题，我就以为没问题了，结果后面运行py才发现存在问题</strong></p>
<p><img src="https://s2.loli.net/2024/10/21/OrqJRFQxeSnAh23.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>这一行是什么用处呢？</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs tcl">如果缺少 setMaxDigits(<span class="hljs-number">129</span>); 这一行代码导致加密过程卡死，可能是因为加密库在处理大数运算时遇到了未配置的位数限制，造成了以下问题：<br><br>位数限制未配置：大数运算库（如 jsbn）通常有一个默认的最大位数限制。如果你的加密操作涉及到的数字位数超过了这个默认限制，而没有调用 setMaxDigits 来调整这个限制，库可能无法正确处理这些大数。这会导致计算无法完成，从而卡死。<br><br>库的内部实现：在一些大数库中，未设置足够大的位数可能会导致计算内部的缓冲区溢出或其他资源不足的问题。库内部可能会尝试使用默认的较小位数来处理大数运算，但当实际需求超出这个范围时，可能会导致无限等待或计算卡住。<br><br>加密算法的要求：RSA 加密需要处理相当大的数字（例如，<span class="hljs-number">2048</span> 位或更大的密钥）。如果库未配置足够大的位数来处理这些加密需求，它可能会陷入无法处理的状态。setMaxDigits 确保库有足够的位数来处理 RSA 密钥的大小。<br></code></pre></td></tr></table></figure>

<p><strong>反正就是缺少这个位数限制配置的话，可能会导致计算密码时程序卡死</strong></p>
<p>现在我们注释掉这一行配置，再看看运行加密脚本是什么情况？</p>
<p><img src="https://s2.loli.net/2024/10/21/RXUuB2o7FSvflwJ.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><img src="https://s2.loli.net/2024/10/21/1EwqNxzeiOBnL8h.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><strong>程序果然卡死了，但试了几次发现这种卡死是有几率的，不一定会每次都卡死，但最好还是加上这一行配置吧</strong></p>
<h2 id="验证加密脚本的正确性"><a href="#验证加密脚本的正确性" class="headerlink" title="验证加密脚本的正确性"></a>验证加密脚本的正确性</h2><p>对比一下看看本地加密与网站端加密后的密文是否相似：</p>
<ul>
<li>网站端的</li>
</ul>
<p><img src="https://s2.loli.net/2024/10/21/q2JP9FVK5kXeOtD.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<ul>
<li>本地的</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">1a6b927316a9eaee01d2956d44de329bc5c565badc88677fe50df825bb90d59be8afffcc0bfcca3b21c6e433e898a5a57e50940047269132e24c15e8532d6461bbc18e42dfd0f8e5b606c9423e6250eddd3592d2dbfd77d0e5c65182c74d4c22bf9ba6e8e77e4ea6dcbf70030bd3d510ed065ed65c14f5477f245dece4602736<br></code></pre></td></tr></table></figure>

<p>嗯！形式上是一致的！不过最好的验证方式是，使用正确的账号密码，把密码使用本地的脚本加密，如果能登录成功，那么就说明加密脚本没问题!</p>
<p>于是果断使用手机号注册一个账号</p>
<p><img src="https://s2.loli.net/2024/10/21/BhFbG8wPjkL6igM.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>修改密码，保存好新密码</p>
<p><img src="https://s2.loli.net/2024/10/21/GTScJVu8qkQUh9E.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><strong>输入正确的密码，登录，burp拦截住登录包</strong></p>
<p><img src="https://s2.loli.net/2024/10/21/M8d3ie1t5Fgr6RP.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>成功拦下登录包，<strong>丢包，不要放行</strong>，使得保持<strong>未登录</strong>状态<img src="https://s2.loli.net/2024/10/21/R3aJXCYyW7zHNKe.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>把数据包发送到<strong>重放模块</strong>，也<strong>不要着急发送数据包</strong></p>
<p>先使用之前我们写好的加密脚本<strong>encrypt.py</strong>，对我<strong>正确的密码</strong>进行加密，得到加密数据</p>
<p><img src="https://s2.loli.net/2024/10/21/6hCNk2xLDjFiqVv.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>ok，<strong>把加密后的密文与数据包中密码参数pwd替换，发包登录，如果登录成功，就说明我们的加密脚本完全没有问题，加密出的数据可被服务器端成功解密</strong></p>
<p>忘了说了还需要过一个验证码</p>
<p><img src="https://s2.loli.net/2024/10/21/s2IAXnOSFypEdYz.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>登录失败！？翻车了？白忙活了？</p>
<p><img src="https://s2.loli.net/2024/10/21/kb5eHinTKYxL9CG.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>不会吧……（陷入沉思）</p>
<p><strong>推测是对数据包做了防篡改，就是类似于sign签名的机制，使用某些参数存储用户的唯一会话，推测这种校验字段与数据包中的数据做了绑定，于是就达到了数据包防篡改的目的</strong></p>
<p>看看cookie验证一下我的推测</p>
<p>这是未登录的cookie，就有这么多值</p>
<p><img src="https://s2.loli.net/2024/10/21/dgx3uQIt9mwLanE.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>解释一下参数的作用（只是大概推测）</p>
<p>这是一个包含多个 Cookie 参数的示例。每个参数在 web 开发和分析中都有不同的用途。下面是这些参数的解释：</p>
<ol>
<li><strong><code>global_cookie</code></strong>: 这是一个用户的全局 Cookie，通常用于跟踪用户的会话或存储全局状态信息。</li>
<li><strong><code>g_sourcepage</code></strong>: 该 Cookie 可能用于记录用户访问的页面来源或渠道。表示用户的来源页和设备类型（例如 PC）。</li>
<li><strong><code>__utmc</code></strong>: 这是 Google Analytics 的一个 Cookie，用于跟踪用户会话。它帮助 Google Analytics 了解用户在网站上的活动时间。</li>
<li><strong><code>city</code></strong>: 记录用户所在的城市。<code>bj</code> 表示北京。</li>
<li><strong><code>__utma</code></strong>: 这是另一个 Google Analytics 的 Cookie，用于记录用户的首次访问时间、上次访问时间和访问次数。</li>
<li><strong><code>__utmz</code></strong>: 该 Cookie 用于记录用户的来源信息，例如搜索引擎、广告活动或直接访问。表示用户的访问来源是通过 <code>my.fang.com</code>，且是通过推荐链接访问的。</li>
<li><strong><code>__utmt_t0</code></strong> 和 <strong><code>__utmt_t1</code></strong>: 这些是 Google Analytics 的 Cookie，用于管理和限制请求速率，以避免过多的服务器负担。<code>1</code> 是其值。</li>
<li><strong><code>token</code></strong>: 用于存储用户的认证令牌或会话 ID。</li>
<li><strong><code>unique_cookie</code></strong>: 这是一个唯一标识符，用于唯一标识用户。</li>
<li><strong><code>__utmb</code></strong>: 这是 Google Analytics 的一个 Cookie，用于计算用户的会话持续时间。它与 <code>__utmc</code> 一起使用，帮助分析用户在网站上的活动。</li>
</ol>
<p><strong>反正分析了一下，就这两个参数很可疑</strong></p>
<p><strong><code>token</code></strong>:</p>
<ul>
<li><strong>作用</strong>: 通常，<code>token</code> 用于存储用户的会话标识符或认证令牌。它可以是一个生成的唯一值，用于标识用户的会话。虽然它本身不直接用于签名或校验数据包是否被篡改，但它确实在会话管理中发挥重要作用。</li>
<li><strong>安全性</strong>: 令牌通常是随机生成的，且与用户会话相关联。如果令牌被篡改或伪造，服务器可以检测到并拒绝请求。</li>
</ul>
<p><strong>如果我的加密脚本没有错误的话，就是这里做了数据包放窜改校验，推测应该是每一个数据包随机生成一个token，具备类似于sign值的功能，把当前数据包的token与POST的数据做了一个绑定，服务器端只通过与token进行了绑定的数据，其他数据(比如做了改包操作)，就被视为不合法的数据，无法被解密出来，也就无法成功登录</strong></p>
<p>over</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/WEB%E6%94%BB%E9%98%B2/" class="category-chain-item">WEB攻防</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/JS%E9%80%86%E5%90%91/" class="print-no-link">#JS逆向</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>JS逆向实战-房天下登录系统</div>
      <div>https://x1lys.github.io/2024/08/02/JS逆向实战-房天下登录系统/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>X1ly?S</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年8月2日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/08/06/beef%E4%B8%80%E6%AC%BEXSS%E7%A5%9E%E5%99%A8/" title="beef一款XSS神器">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">beef一款XSS神器</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/08/02/SRC%E6%A1%88%E4%BE%8B-%E4%BB%8E%E9%80%86%E5%90%91JS%E5%8A%A0%E5%AF%86%E5%88%B0%E8%8E%B7%E5%8F%96%E5%87%A0%E5%8D%81%E4%B8%87%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90/" title="SRC案例-从逆向JS加密到获取几十万用户权限">
                        <span class="hidden-mobile">SRC案例-从逆向JS加密到获取几十万用户权限</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
